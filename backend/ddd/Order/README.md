業務アプリケーションの関心ごとはコトの管理です。
業務アプリケーションのデータベースに必要なこと
・現実に起きたコトの記録
・将来起きるコトの記録(約束の記録)

テーブル設計、NOT NULL 制約にする
現実に起きたコトの記録するのに NULL(不明)であってはいけません。
NOT NULL 制約を徹底する方法として、記憶のタイミングが異なる事実は別テーブルにする。
記憶するタイミングが異なるデータを 1 つのテーブルで記憶しようとすると NULL 可能なカラムが必要になります。

コトの記憶テーブルの更新を禁止する
過去の記録を修正したい場合は、[過去の記録の取り消し]を記録します。
更に修正する事実を別の記録として追加します。
取り消しも修正も INERT で OK
会計処理における[赤黒処理]と呼ばれる訂正方法と同じ考え方です。
会計を訂正する場合は、誤った金額をマイナス計上(赤)し、正しい金額をプラス計上(黒)します。

データベースは本質の事実の記録です。
コト:口座に入金=>入金テーブルに記録=>残高テーブルに口座残高を増やす。
コト:口座に出金=>入金テーブルに記録=>残高テーブルに口座残高を減らす。

コトの記録はデータの本質的な記録であり、残高の更新は二次的な導出処理です。
コトの記録と残高の更新をトランザクションにまとめない方法を探る。

非同期メッセージングに残高の更新を任せる。
・コトの発生を顧客管理サーバに通知すると、顧客管理サーバは、顧客単位の残高を更新する
・同じコトの発生を営業管理サーバに通知すると、営業管理サーバは、売上部門別の売上高を算出する
